/*
 * HWManager.c
 *
 *  Created on: 11.02.2019
 *      Author: dinkelsv64505
 */

#include "HW_Init.h"

#include <stdint.h>

uint32_t rtc_pin = 0;

void hw_init_init()
{
	for (int i = 0; i < sizeof(setPinFct) / sizeof(SetPin_Fct); i++)
	{
		setPinFct[i] = &db_as_PinIdUnknown;
}
}

uint8_t hw_init_registerPINIdentfier(uint8_t pinID, SetPin_Fct fct)
{
	setPinFct[pinID] = fct;
}

void hw_init_gpio()
{

	// Read HW Info
	HW_ID = FLASH_ReadByte(_MEMORY_HWCONFIG_BEGIN_);
	HW_VERSION = FLASH_ReadByte(_MEMORY_HWCONFIG_BEGIN_ + 1);
	HW_BUS_DEV_NUM = FLASH_ReadByte(_MEMORY_HWCONFIG_BEGIN_ + 2);

	// Read Local Pin Config
	uint32_t currPin = GPIO_Pin_0;
	for (int i = 0; i < NUM_LOCAL_PIN; i++)
	{
		uint8_t pinMode = FLASH_ReadByte(_MEMORY_HWCONFIG_BEGIN_ + 16 + i);
		setPinFct[pinMode](currPin);
		currPin = currPin << 1;
	}

	// Read Ext Pin Config
	currPin = NUM_LOCAL_PIN;
	for (int i = 0; i < NUM_EXT_PIN; i++)
	{
		uint8_t pinMode = FLASH_ReadByte(_MEMORY_HWCONFIG_BEGIN_ + 16 + i);
		setPinFct[pinMode](currPin);
		currPin++;
	}

//	currPin = PIN0;
//	for(bla)
//	{
//		function = flahs read byte // rtc code define 5
//		switch(function )
//		5. setRtcPin(currPin);
//		6: tempSensPin(currOiubn);
//		pin += 10;
//	}
//	PIN_0 = FLASH
//	READ BYTE
//
//	rtc_pin = gpio_pin0;
}

